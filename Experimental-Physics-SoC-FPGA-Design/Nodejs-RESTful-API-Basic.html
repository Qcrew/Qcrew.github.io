

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Nodejs RESTful API Basic &mdash; Qcrew Documentation  documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
        <script async="async" type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Summary" href="Summary.html" />
    <link rel="prev" title="Verilog MemoryMapper" href="Verilog-MemoryMapper.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Qcrew Documentation
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Electronics and Coding</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Experimental Physics: SoC FPGA Design</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="Design-Plan.html">Design Plan</a></li>
<li class="toctree-l2"><a class="reference internal" href="Linux-Tips.html">Linux Tips</a></li>
<li class="toctree-l2"><a class="reference internal" href="Processor-FPGA-Communication-FPGA-Part.html">Processor-FPGA Communication: FPGA Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="Processor-FPGA-Communication-Processor-Part.html">Processor-FPGA Communication: Processor Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAILED-Processor-FPGA-Communication-Using-FIFO-FPGA-Part.html">FAILED Processor-FPGA Communication: Using FIFO FPGA Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="FAILED-Processor-FPGA-Communication-Using-FIFO-Processor-Part.html">FAILED Processor-FPGA Communication: Using FIFO Processor Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="Processor-FPGA-Communication-Using-FIFO-FPGA-Part.html">Processor-FPGA Communication: Using FIFO FPGA Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="Processor-FPGA-Communication-Using-FIFO-Processor-Part.html">Processor-FPGA Communication: Using FIFO Processor Part</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nodejs-Talking-To-C-Executable-1.html">Nodejs Talking To C Executable 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nodejs-Talking-To-C-Executable-2.html">Nodejs Talking To C Executable 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verilog-DataSender.html">Verilog DataSender</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verilog-My16ChannelCounter.html">Verilog My16ChannelCounter</a></li>
<li class="toctree-l2"><a class="reference internal" href="Verilog-MemoryMapper.html">Verilog MemoryMapper</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Nodejs RESTful API Basic</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#what-is-the-idea">What is the idea?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#backend-server">Backend Server</a></li>
<li class="toctree-l3"><a class="reference internal" href="#frontend-client">Frontend Client</a></li>
<li class="toctree-l3"><a class="reference internal" href="#username-password-authentication">Username/Password Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#facebook-authentication">Facebook authentication</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="Summary.html">Summary</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nodejs-RESTful-API-Email-Verification.html">Nodejs RESTful API Email Verification</a></li>
<li class="toctree-l2"><a class="reference internal" href="Nodejs-RESTful-API-Production.html">Nodejs RESTful API Production</a></li>
<li class="toctree-l2"><a class="reference internal" href="React-Native-Redux-1.html">React Native Redux 1</a></li>
<li class="toctree-l2"><a class="reference internal" href="React-Native-Redux-2.html">React Native Redux 2</a></li>
<li class="toctree-l2"><a class="reference internal" href="React-Native-Redux-3.html">React Native Redux 3</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Qcrew Documentation</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="index.html">Experimental Physics: SoC FPGA Design</a> &raquo;</li>
        
      <li>Nodejs RESTful API Basic</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/Experimental-Physics-SoC-FPGA-Design/Nodejs-RESTful-API-Basic.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="nodejs-restful-api-basic">
<h1>Nodejs RESTful API Basic<a class="headerlink" href="#nodejs-restful-api-basic" title="Permalink to this headline">¶</a></h1>
<dl class="field-list simple">
<dt class="field-odd">Date</dt>
<dd class="field-odd"><p>5 Oct 2019</p>
</dd>
</dl>
<div class="section" id="what-is-the-idea">
<h2>What is the idea?<a class="headerlink" href="#what-is-the-idea" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>In the previous parts we use <strong>Socket.io + WebSocket</strong> to handle communication between nodejs server and client</p></li>
<li><p>In this part we make an alternative: <strong>RESTful API</strong></p></li>
</ul>
</div>
<div class="section" id="backend-server">
<h2>Backend Server<a class="headerlink" href="#backend-server" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>index.js</strong></p></li>
</ul>
<div class="highlight-javascript notranslate"><div class="highlight"><pre><span></span><span class="kd">var</span> <span class="nx">app</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;express&#39;</span><span class="p">)()</span>
<span class="kd">var</span> <span class="nx">jsonParser</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;body-parser&#39;</span><span class="p">).</span><span class="nx">json</span><span class="p">()</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">=&gt;{</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">sendFile</span><span class="p">(</span><span class="nx">__dirname</span><span class="o">+</span><span class="s1">&#39;/index.html&#39;</span><span class="p">);</span>
<span class="p">})</span>

<span class="nx">app</span><span class="p">.</span><span class="nx">post</span><span class="p">(</span><span class="s1">&#39;/&#39;</span><span class="p">,</span> <span class="nx">jsonParser</span><span class="p">,</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="s2">&quot;You sent: &quot;</span><span class="o">+</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">req</span><span class="p">.</span><span class="nx">body</span><span class="p">));</span>
<span class="p">})</span>

<span class="kd">var</span> <span class="nx">port</span> <span class="o">=</span> <span class="mi">3000</span><span class="p">;</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">port</span><span class="p">,</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`http://localhost:</span><span class="si">${</span><span class="nx">port</span><span class="si">}</span><span class="sb">`</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="section" id="frontend-client">
<h2>Frontend Client<a class="headerlink" href="#frontend-client" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>index.html</strong></p></li>
</ul>
<div class="highlight-html notranslate"><div class="highlight"><pre><span></span><span class="p">&lt;</span><span class="nt">div</span> <span class="na">id</span><span class="o">=</span><span class="s">&quot;demo&quot;</span><span class="p">&gt;&lt;/</span><span class="nt">div</span><span class="p">&gt;</span>
<span class="p">&lt;</span><span class="nt">script</span><span class="p">&gt;</span>
        <span class="kd">var</span> <span class="nx">xhttp</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
        <span class="nx">xhttp</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">==</span> <span class="mi">4</span> <span class="o">&amp;&amp;</span> <span class="k">this</span><span class="p">.</span><span class="nx">status</span> <span class="o">==</span> <span class="mi">200</span><span class="p">)</span> <span class="p">{</span>
                <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&quot;demo&quot;</span><span class="p">).</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">};</span>

        <span class="nx">xhttp</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="s2">&quot;POST&quot;</span><span class="p">,</span> <span class="s2">&quot;http://localhost:3000&quot;</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
        <span class="nx">xhttp</span><span class="p">.</span><span class="nx">setRequestHeader</span><span class="p">(</span><span class="s2">&quot;Content-type&quot;</span><span class="p">,</span> <span class="s2">&quot;application/json&quot;</span><span class="p">);</span>

        <span class="kd">var</span> <span class="nx">object</span> <span class="o">=</span> <span class="p">{</span><span class="nx">key</span><span class="o">:</span><span class="s2">&quot;value&quot;</span><span class="p">};</span>
        <span class="nx">xhttp</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">(</span><span class="nx">object</span><span class="p">));</span>
<span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</pre></div>
</div>
</div>
<div class="section" id="username-password-authentication">
<h2>Username/Password Authentication<a class="headerlink" href="#username-password-authentication" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The following is from <a class="reference external" href="https://stackoverflow.com/questions/14572600/passport-js-restful-auth">here</a></p></li>
</ul>
<p>Let’s look at how plain old authentication works first.</p>
<ul class="simple">
<li><p>The user connects to <a class="reference external" href="https://example.com">https://example.com</a></p></li>
<li><p>The server serves a rich Javascript application which renders the initial page. Somehwere in the page there is a login form.</p></li>
<li><p>Many of the sections of this single page app haven’t been populated with data due to the user not being logged in. All these sections have an event listener on a “login” event. All this is client side stuff, the server does not know of these events.</p></li>
<li><p>User enters his/her login and password and hits the submit button, which triggers a Javascript handler to record the username and password in client side variables. Then this handler triggers the “login” event. Again, this is all client side action, credentials were not sent to the server yet.</p></li>
<li><p>The listeners of the “login” event are invoked. Each of these now needs to send one or more requests to the RESTful API at <a class="reference external" href="https://example.com/api">https://example.com/api</a> to obtain the user specific data to render on the page. Every single request they send to the web service will include the username and password, possibly in the form of HTTP Basic authentication, since the service being RESTful isn’t allowed to maintain client state from one request to the next. Since the web service is on secure HTTP the password is safely encrypted during transit.</p></li>
<li><p>The web service at <a class="reference external" href="https://example.com/api">https://example.com/api</a> receives a bunch of individual requests, each with authentication information. The username and password in each request is checked against the user database and if found correct the requested function executes and data is returned to the client in JSON format. If username and password do not match an error is sent to the client in the form of a 401 HTTP error code.</p></li>
<li><p>Instead of forcing clients to send username and password with every request you can have a “get_access_token” function in your RESTful service that takes the username and password and responds with a token, which is some sort of cryptographic hash that is unique and has some expiration date associated with it. These tokens are stored in the database with each user. Then the client sends the access token in subsequent requests. The access token will then be validated against the database instead of the username and password.</p></li>
<li><p>Non browser client applications like phone apps do the same as above, they ask user to enter his/her credentials, then send them (or an access token generated from them) with every request to the web service.</p></li>
<li><p>The important take away point from this example is that RESTful web services require authentication with every request.</p></li>
</ul>
</div>
<div class="section" id="facebook-authentication">
<h2>Facebook authentication<a class="headerlink" href="#facebook-authentication" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>The following is from <a class="reference external" href="https://stackoverflow.com/questions/14572600/passport-js-restful-auth">here</a></p></li>
</ul>
<p>The workflow above does not work for Facebook connect because the login via Facebook has a third party, Facebook itself. The login procedure requires the user to be redirected to Facebook’s website where credentials are entered outside of our control.</p>
<p>So let’s see how things change:.</p>
<ul class="simple">
<li><p>The user connects to <a class="reference external" href="https://example.com">https://example.com</a></p></li>
<li><p>The server serves a rich Javascript application which renders the initial page. Somehwere in the page there is a login form that includes a “Login with Facebook” button.</p></li>
<li><p>The user clicks the “Login with Facebook” button, which is just a link that redirects to (for example) <a class="reference external" href="https://example.com/auth/facebook">https://example.com/auth/facebook</a>.</p></li>
<li><p>The <a class="reference external" href="https://example.com/auth/facebook">https://example.com/auth/facebook</a> route is handled by passport.js (see the documentation)</p></li>
<li><p>All the user sees is that the page changes and now they are in a Facebook hosted page where they need to login and authorize our web application. This is completely outside of our control.</p></li>
<li><p>The user logs in to Facebook and gives permission to our application, so Facebook now redirects back to the callback URL that we configured in the passport.js setup, which following the example in the documentation is <a class="reference external" href="https://example.com/auth/facebook/callback">https://example.com/auth/facebook/callback</a></p></li>
<li><p>The passport.js handler for the <a class="reference external" href="https://example.com/auth/facebook/callback">https://example.com/auth/facebook/callback</a> route will invoke the callback function that receives the Facebook access token and some user information from Facebook, including the user’s email address.</p></li>
<li><p>With the email we can locate the user in our database and store the Facebook access token with it.</p></li>
<li><p>The last thing you do in the Facebook callback is to redirect back to the rich client application, but this time we need to pass the username and the access token to the client so that it can use them. This can be done in a number of ways. For example, Javascript variables can be added to the page through a server-side template engine, or else a cookie can be returned with this information. (thanks to &#64;RyanKimber for pointing out the security issues with passing this data in the URL, as I initially suggested).</p></li>
<li><p>So now we start the single page app one more time, but the client has the username and the access token.</p></li>
<li><p>The client application can trigger the “login” event immediately and let the different parts of the application request the information that they need from the web service.</p></li>
<li><p>All the requests sent to <a class="reference external" href="https://example.com/api">https://example.com/api</a> will include the Facebook access token for authentication, or the application’s own access token generated from Facebook’s token via a “get_access_token” function in the REST API.</p></li>
<li><p>The non-browser apps have it a bit more difficult here, because OAuth requires a web browser for logging in. To login from a phone or desktop app you will need to start a browser to do the redirect to Facebook, and even worse, you need a way for the browser to pass the Facebook access token back to the application via some mechanism.</p></li>
</ul>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="Summary.html" class="btn btn-neutral float-right" title="Summary" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="Verilog-MemoryMapper.html" class="btn btn-neutral float-left" title="Verilog MemoryMapper" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Qcrew

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>